<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="MainTree">
  <BehaviorTree ID="JogForward">
    <AlwaysFailure/>
  </BehaviorTree>

  <BehaviorTree ID="MainTree">
    <Sequence name="OperationCycle">
      <Fallback>
        <ForkUp/>
        <moveForks editable=""
                   fork_angle="0"/>
      </Fallback>
      <IfThenElse name="CheckTelePos">
        <TelescopeHomeSensors/>
        <IfThenElse name="CheckTotePos">
          <BinPresenceSensors/>
          <IfThenElse>
            <TelePos act_position="act_telescope_position"/>
            <Switch3 case_1="0"
                     case_2="1"
                     case_3="2"
                     variable="turntable_dir">
              <SubTree ID="internal_rack"
                       _autoremap="false"/>
              <SubTree ID="external_single_deep"/>
              <SubTree ID="external_double_deep"/>
            </Switch3>
          </IfThenElse>
          <SubTree ID="RetractLogic"/>
        </IfThenElse>
        <SubTree ID="JogForward"/>
      </IfThenElse>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="RetractLogic">
    <AlwaysSuccess/>
  </BehaviorTree>

  <BehaviorTree ID="external_double_deep">
    <AlwaysSuccess/>
  </BehaviorTree>

  <BehaviorTree ID="external_single_deep">
    <AlwaysSuccess/>
  </BehaviorTree>

  <BehaviorTree ID="internal_rack">
    <Fallback>
      <Lift_Pos lift_act_pos="rack_height"/>
      <Sequence>
        <moveLift lift_target_pos="rack_height"/>
        <Fallback>
          <turn_pos turn_act_pos="home"/>
          <Sequence>
            <moveTurntable turntable_target_pos="home"/>
            <RackSensors/>
            <moveTelescope telescope_target_pos="telepick_internal_deep1_mm"/>
            <Fallback>
              <BinClearSensors/>
            </Fallback>
          </Sequence>
        </Fallback>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Condition ID="BinClearSensors"
               editable="true"/>
    <Condition ID="BinPresenceSensors"/>
    <Condition ID="ForkUp"/>
    <Condition ID="Lift_Pos"
               editable="true">
      <input_port name="lift_act_pos"/>
    </Condition>
    <Condition ID="RackSensors"
               editable="true"/>
    <Condition ID="TelePos">
      <output_port name="act_position"/>
    </Condition>
    <Condition ID="TelescopeHomeSensors"/>
    <Action ID="moveForks">
      <inout_port name="editable"/>
      <input_port name="fork_angle"
                  default="0">Fork Angle in Degrees</input_port>
    </Action>
    <Action ID="moveLift"
            editable="true">
      <input_port name="lift_target_pos"/>
    </Action>
    <Action ID="moveTelescope"
            editable="true">
      <input_port name="telescope_target_pos"/>
    </Action>
    <Action ID="moveTurntable"
            editable="true">
      <input_port name="turntable_target_pos"/>
    </Action>
    <Condition ID="turn_pos"
               editable="true">
      <input_port name="turn_act_pos"/>
    </Condition>
  </TreeNodesModel>

</root>
