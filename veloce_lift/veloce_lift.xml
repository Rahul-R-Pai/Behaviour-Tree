<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">
    <Sequence name="PickCycle">
      <!-- Safety and Mode Checks -->
      <CheckBool name="CheckSTO" variable="STO" expected_value="false"/>
      <CheckEqual name="CheckMode888" variable="Input_cmd_moc" value="888"/>
      <CheckBool name="CheckPICKCommand" variable="PICK" expected_value="true"/>
      <CheckIntEqual name="CheckT2Equals8" variable="t2" value="8"/>

      <!-- Begin Pick Steps -->
      <Fallback name="PickStepSelector">
        <!-- Pick Step 0 -->
        <Sequence name="PickStep0">
          <CheckIntEqual name="CheckPickStep0" variable="PICKSTEP" value="0"/>
          <Action name="SetTurnMode" variable="Turn_mode" value="1"/>
          <Action name="StartPickStep1"/>
        </Sequence>

        <!-- Pick Step 1 -->
        <Sequence name="PickStep1">
          <CheckIntEqual name="CheckPickStep1" variable="PICKSTEP" value="1"/>
          <CheckBool name="CheckTelescopeNotStalled" variable="Telescope_stalled" expected_value="false"/>
          <Action name="SetTurnCorrectionStep" variable="Turn_Corr_Step" value="1"/>
          <Action name="StartPickStep2"/>
        </Sequence>

        <!-- Additional steps (abbreviated for brevity) -->
        <Sequence name="PickStep2">
          <CheckIntEqual name="CheckPickStep2" variable="PICKSTEP" value="2"/>
          <CheckBool name="CheckTelescopeNotStalled" variable="Telescope_stalled" expected_value="false"/>
          <Action name="SetTurnCorrectionStep2" variable="Turn_Corr_Step" value="2"/>
          <Action name="SetRackCycle" variable="RACK_CYCLE" value="1"/>
          <Action name="StartPickStep3"/>
        </Sequence>

        <!-- Pick Completion -->
        <Sequence name="PickComplete">
          <CheckIntEqual name="CheckPickStepComplete" variable="PICKSTEP" value="12"/>
          <Action name="SetPickComplete" variable="pick_comp" value="true"/>
        </Sequence>
      </Fallback>

    </Sequence>
